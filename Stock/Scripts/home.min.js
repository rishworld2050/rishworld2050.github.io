var stkApp=angular.module('stockApp',['ngWebSocket']);stkApp.factory('FetchSocketData',['$websocket',function(a){var b=a('ws://stocks.mnet.website'),c=[];b.onMessage(function(e){c[0]=JSON.parse(e.data)});return{data:c,get:function(){b.send(JSON.stringify({action:'get'}))}}}]),stkApp.controller('StockController',['FetchSocketData','$scope',function(a,b){b.currentChartView='',b.chartData={},b.stockData={},b.test=a,setInterval(function(){b.processData(angular.copy(b.test.data[0]))},1e3),b.processData=function(c){var d;c!==void 0&&c.forEach(([e,f])=>{d=parseFloat(`${f}`),b.stockData.hasOwnProperty(`${e}`)?d!==b.stockData[`${e}`].price&&(b.stockData[`${e}`].color=d<b.stockData[`${e}`].price?'red':'green',b.stockData[`${e}`].delta=d<b.stockData[`${e}`].price?b.calDownValue(d,b.stockData[`${e}`].price):b.calUpValue(d,b.stockData[`${e}`].price),b.stockData[`${e}`].price=d,b.stockData[`${e}`].timestamp=new Date().toLocaleString(),b.chartData.hasOwnProperty(`${e}`)&&b.chartData[`${e}`].push([b.chartData[`${e}`].length,d]),`${e}`===b.currentChartView&&b.renderChart()):(b.stockData[`${e}`]={name:`${e}`,price:d,color:'white',delta:'0',timestamp:new Date().toLocaleString()},!b.chartData.hasOwnProperty(`${e}`)&&(b.chartData[`${e}`]=[],b.chartData[`${e}`].push(['Index','Price']),b.chartData[`${e}`].push([b.chartData[`${e}`].length,d])),0===b.currentChartView.length&&(b.currentChartView=`${e}`),`${e}`===b.currentChartView&&b.renderChart())})},b.calDownValue=function(c,d){return'-'+parseFloat(100*((d-c)/d)).toFixed(2)+'%'},b.calUpValue=function(c,d){return'+'+parseFloat(100*((c-d)/d)).toFixed(2)+'%'},b.renderChart=function(){google.charts.load('current',{packages:['corechart']}),google.charts.setOnLoadCallback(b.drawChart)},b.drawChart=function(){var c=new google.visualization.arrayToDataTable(b.chartData[b.currentChartView]),d={title:'Stock Price Trend : '+b.currentChartView,legend:{position:'bottom'},hAxis:{textStyle:{fontSize:0,color:'#fff'}}},e=new google.visualization.LineChart(document.getElementById('TrendChartContainer'));e.draw(c,d)}}]);